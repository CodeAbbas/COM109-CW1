<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bakery</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boostrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="../../styles/style.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="hero">
          <a href="#" class="navbar-logo"><img src="../../img/AliStore.jpg" alt="Ali Store"></a>
          <ul class="navbar-menu">
            <li><a href="../../index.html">Home</a></li>
            <li><a href="../../about.html">About</a></li>
            <li>
              <div class="dropdown">
                <div class="dropbtn"><a href="../../index.html#products" style="transition: 0.1s;">Products <i class="fa fa-angle-down"></i></a></div>
                <div class="dropdown-content">
                  <a href="../produce/produce.html">Produce</a>
                  <a href="#">Meat</a>
                  <a href="../Dairy/dairy.html">Dairy</a>
                  <a href="../Bakery/bakery.html">Bakery</a>
                  <a href="../Carbohydrate/carbohydrate.html">Carbohydrate</a>
                  <a href="../Snacks&Sides/snacks.html">Snacks & Sides</a>
                  <a href="../Drinks/drinks.html">Soft Drinks</a>
                  <a href="../Households/households.html">Households</a>
                  <a href="../new.html">New added..</a>
                </div>
              </div>
            </li>
            <li><a href="../../index.html#contact">Contact</a></li>
            <button class="signin"><a href="../../users/signin.html">Sign in</a></button>
          </ul>
          <div class="nav-buttons">
            <div class="dark-light">
              <svg style="width:24px; margin: 10px; " viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
              </svg>
            </div>
            <div class="cart">
              <svg xmlns="http://www.w3.org/2000/svg" style="width:24px; margin: 10px;" fill="currentColor" class="bi bi-cart2" viewBox="0 0 16 19">
                <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5M3.14 5l1.25 5h8.22l1.25-5zM5 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0m9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0" />
              </svg>
            </div>
  
          </div>
  
        </div>
        <div class="hamburger">
          <span class="line"></span>
          <span class="line"></span>
          <span class="line"></span>
        </div>
  
        <div class="cart-container">
          <i class="fa-solid fa-xmark" id="close"></i>
          <h2>Cart</h2>
          <table>
            <thead>
              <tr>
                <th><strong>Product</strong></th>
                <th><strong>Price</strong></th>
              </tr>
            </thead>
            <tbody id="carttable">
            </tbody>
          </table>
          <hr>
          <table id="carttotals">
            <tr>
              <td><strong>Items</strong></td>
              <td><strong>Total</strong></td>
            </tr>
            <tr>
              <td>x <span id="itemsquantity">0</span></td>
  
              <td>£<span id="total">0</span></td>
            </tr>
          </table>
  
          <div class="cart-buttons">
            <button id="emptycart">Empty Cart</button>
            <button id="checkout">Checkout</button>
          </div>
        </div>
      </nav>
    <section class="products" id="products">
        <div class="prod-title">
          <h1 class="heading-h1">Bakery</h1>
        </div>
        
        <div class="product-grid">
          <div class="product-item">
            <img loading="lazy" src="../../img/bakery/croissant.avif" alt="Produce">
            <h2 class="productname">Croissant</h2>
            <p>Product description</p>
            <p class="price">£0.99</p>
            <button class="addtocart">Add to Cart</button>
            <button class="signin"><a href="./croissant.html">View</a></button>
          </div>
          <div class="product-item">
            <img loading="lazy" src="../../img/bakery/donut1.png" alt="Meat">
            <h2 class="productname">Donut</h2>
            <p>Product description</p>
            <p class="price">£1.49</p>
            <button class="addtocart">Add to Cart</button>
            <button class="signin"><a href="./lamb.html">View</a></button>
          </div>
          <div class="product-grid">
            <div class="product-item">
              <img loading="lazy" src="../../img/bakery/croissant.avif" alt="Produce">
              <h2 class="productname">Croissant</h2>
              <p>Product description</p>
              <p class="price">£0.99</p>
              <button class="addtocart">Add to Cart</button>
              <button class="signin"><a href="./croissant.html">View</a></button>
            </div>
            <div class="product-item">
              <img loading="lazy" src="../../img/bakery/donut1.png" alt="Meat">
              <h2 class="productname">Donut</h2>
              <p>Product description</p>
              <p class="price">£1.49</p>
              <button class="addtocart">Add to Cart</button>
              <button class="signin"><a href="./lamb.html">View</a></button>
            </div>
        </div>
    </section>
    
    <script>
        // Error handling for menu toggle
const hamburger = document.querySelector(".hamburger");
const navbarMenu = document.querySelector(".navbar-menu");

if (hamburger && navbarMenu) {
  hamburger.addEventListener("click", () => {
    hamburger.classList.toggle("active");
    navbarMenu.classList.toggle("active");
  });
} else {
  console.error("Error!");
}
// Cart
const cart = document.querySelector(".cart");
const cartMenu = document.querySelector(".cart-container");
const closeButton = document.querySelector("#close");

if (cart && cartMenu) {
  cart.addEventListener("click", () => {
    cart.classList.toggle("active");
    cartMenu.classList.toggle("active");

    setTimeout(() => {
      cart.classList.remove("active");
      cartMenu.classList.remove("active");
    }, 60000);
  });
  closeButton.addEventListener("click", () => {
    cart.classList.remove("active");
    cartMenu.classList.remove("active");
  });
} else {

  console.error("Error!");

}
  //cart js
/* get cart total from session on load */
updateCartTotal();

/* button event listeners */
document.getElementById("emptycart").addEventListener("click", emptyCart);
var btns = document.getElementsByClassName('addtocart');
for (var i = 0; i < btns.length; i++) {
    btns[i].addEventListener('click', function() {addToCart(this);});
}

/* ADD TO CART functions */

function addToCart(elem) {
    //init
    var sibs = [];
    var getprice;
    var getproductName;
    var cart = [];
     var stringCart;
    //cycles siblings for product info near the add button
    while(elem = elem.previousSibling) {
        if (elem.nodeType === 3) continue; // text node
        if(elem.className == "price"){
            getprice = elem.innerText;
        }
        if (elem.className == "productname") {
            getproductName = elem.innerText;
        }
        sibs.push(elem);
    }
    //create product object
    var product = {
        productname : getproductName,
        price : getprice
    };
    //convert product data to JSON for storage
    var stringProduct = JSON.stringify(product);
    /*send product data to session storage */
    
    if(!sessionStorage.getItem('cart')){
        //append product JSON object to cart array
        cart.push(stringProduct);
        //cart to JSON
        stringCart = JSON.stringify(cart);
        //create session storage cart item
        sessionStorage.setItem('cart', stringCart);
        addedToCart(getproductName);
        updateCartTotal();
    }
    else {
        //get existing cart data from storage and convert back into array
       cart = JSON.parse(sessionStorage.getItem('cart'));
        //append new product JSON object
        cart.push(stringProduct);
        //cart back to JSON
        stringCart = JSON.stringify(cart);
        //overwrite cart data in sessionstorage 
        sessionStorage.setItem('cart', stringCart);
        addedToCart(getproductName);
        updateCartTotal();
    }
}
/* Calculate Cart Total */
function updateCartTotal(){
    //init
    var total = 0;
    var price = 0;
    var items = 0;
    var productname = "";
    var carttable = "";
    if(sessionStorage.getItem('cart')) {
        //get cart data & parse to array
        var cart = JSON.parse(sessionStorage.getItem('cart'));
        //get no of items in cart 
        items = cart.length;
        //loop over cart array
        for (var i = 0; i < items; i++){
            //convert each JSON product in array back into object
            var x = JSON.parse(cart[i]);
            //get property value of price
            price = parseFloat(x.price.split('£')[1]);
            productname = x.productname;
            //add price to total
            carttable += "<tr><td>" + productname + "</td><td>£" + price.toFixed(2) + "</td></tr>";
            total += price;
        }
        
    }
    //update total on website HTML
    document.getElementById("total").innerHTML = total.toFixed(2);
    //insert saved products to cart table
    document.getElementById("carttable").innerHTML = carttable;
    //update items in cart on website HTML
    document.getElementById("itemsquantity").innerHTML = items;
}
//user feedback on successful add
function addedToCart(pname) {
  var message = pname + " was added to the cart";
  var alerts = document.getElementById("alerts");
  alerts.innerHTML = message;
  if(!alerts.classList.contains("message")){
     alerts.classList.add("message");
  }
}
/* User Manually empty cart */
function emptyCart() {
    //remove cart session storage object & refresh cart totals
    if(sessionStorage.getItem('cart')){
        sessionStorage.removeItem('cart');
        updateCartTotal();
      //clear message and remove class style
      var alerts = document.getElementById("alerts");
      alerts.innerHTML = "";
      if(alerts.classList.contains("message")){
          alerts.classList.remove("message");
      }
    }
} /* cart js*/

// Error handling for dark mode toggle
const toggleButton = document.querySelector('.dark-light');

if (toggleButton) {
  toggleButton.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
  });
} else {
  console.error("Error!");
}
    </script>
</body>
</html>